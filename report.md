# Google Summer of Code 2019 - report

The 2019 Google Summer of Code project consists in working on the Develop Performance Farm Database and Website, work in progress from 2018. 

The system consists in an API root at the localhost address (127.0.0.1) which stores JSON performance files, generated by a Python script.



#### Code specifics

*client*: contains packages with functions used to generate test results and files, with exception handling. Results are collected with Python modules which analyse hardware, system and database performance. 

*front-end*: contains HTML, CSS and JS code the website is built on, using the React framework.

*web*: contains testing functions, role definitions in the authentication system and parsing of the JSON file, along with conversion of existent results in a downloadable format.

The current application has been built on Python and its module Django, but is missing some features:

* Authentication/authorization tied into the community infrastructure;
* Associating machines with users to upload results to the REST API;
* Checking if a mapping with the same name already exists (`runner.py`);
* Testing account exit appropriately (`collectd.py`);
* Adding test cases of different scale sets (scale=10, 20…);
* Allowing custom tests to be added;
* Website and interface fixes:
  * Allowing building the local application with Node > 9;
  * Improving responsivity when rescaling the window;
  * Bug fixes (popups when clicking Status/Machine without being logged in);
  * Improving design of the homepage and login form;
  * PG PERF FARM and Home redirect to the same page;
  * Contact, License and Privacy Policy pages missing;
  * There might be an issue with URLs not redirecting properly.

In the meanwhile, testing is being made with manually created accounts, although there are some server-side issues related to login.

The system is being developed using Debian 9 and OSX Mojave.



## GSoC 2019 project

#### Migrating from Python2.7 to Python3

Since Python2.7 is no longer going to be maintained in 2020, the community agrees that migrating is necessary. The chosen version is Python3.7.

The major changes encountered are:

* `import` syntax;
* `print` syntax;
* Manually compiled requirements with pip3;
* Upgraded the Django version (see below);
* Switched to the `request` module to make HTTP requests.

Changes have been added to `requirements.txt`. The whole application now works with both versions of Python.



#### osX support

Since the system has been developed using macOS, support for osX operating systems has been added. Being a unix-based distribution, changes have been minor, aside from package managers. 

The client code is now able to collect test results from an operating system different from Linux, yet there seem to be no available packages to collect operating system information on macOS - therefore its section remains empty.



#### Django version changes

Using Django1.11 is recommended because the authentication module is on a Django application, so there might be incompatibilies. The version has nonetheless been updated from 1.11.10 to 1.11.17, since the older one has bugs concerning Python3.



#### Django app changes

The Django application has been partially rewritten, keeping functions and views for records but making the following changes:

- Added a Machines application;
- Added more user-related fields on Machines, for a better handling of user data and foreign keys;
- Added JWT as primary form of authentication;
- Added a simpler User model, using the Django built-in one;
- Allowed record fields to be longer, to allow deeper precision of floating point numbers;
- Aliases, branches and modes can be added manually by admins;
- Simplified the Admin model;
- Avatars have been removed;
- Stricter permissions with CRUD operations;
- Added machine authentication with requests instead of query parameters.



#### Client code changes

The client code has been subject of some bug fixes and minor changes, mostly involving processes and requests handling. The number of customisable options has increased, allowing users to choose between cloning the repository from scratch or not, avoiding exceptions if directories already exist.

The biggest changes have been implemented handling processes: now there is a better handling of PIDs instead of running *killall* on the system, and no exception is thrown if PIDs files are not in the standard location.

There were bugs with results uploading which now have been fixed, using custom options embedded in HTTP requests.



#### Website changes

The website has been completely rewritten using Vue.js, keeping the same style and pages as the older version yet implementing:

- JSON downloadable results;
- Session handling;
- Human-readable results of system collected values;
- Correct routing with history mode;
- Editable machines (system information and status).



#### Authentication

Community authentication is work in progress, using the API of the main Postgres website to get authentication credentials and token. The website is running with admin-made accounts, added through the API and logging in through the website. 



#### Deployment

The website and the API have been deployed on a Debian 9 Stretch server, using Django-REST and Vue.js along with *Nginx*, *wsgi* and *gunicorn*. The application is managed with a *systemd* service. 



#### Future development

Future development most certainly includes finishing setting up authentication on the Postgres infrastructure. Furthermore, development will include bug fixing and development of additional features:

- Style changes to the website (better responsiveness, text align, …);
- Adding custom branches fetched with GitHub (work in progress);
- Adding custom time span on the Status page;
- Improve osX compatibility.



